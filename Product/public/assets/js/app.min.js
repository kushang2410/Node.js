$(function () {
  // Admin Panel settings

  //****************************
  /* This is for the mini-sidebar if width is less then 1170*/
  //****************************
  var setsidebartype = function () {
    var width =
      window.innerWidth > 0 ? window.innerWidth : this.screen.width;
    if (width < 1199) {
      $("#main-wrapper").attr("data-sidebartype", "mini-sidebar");
      $("#main-wrapper").addClass("mini-sidebar");
    } else {
      $("#main-wrapper").attr("data-sidebartype", "full");
      $("#main-wrapper").removeClass("mini-sidebar");
    }
  };
  $(window).ready(setsidebartype);
  $(window).on("resize", setsidebartype);
  //****************************
  /* This is for sidebartoggler*/
  //****************************
  $(".sidebartoggler").on("click", function () {
    $("#main-wrapper").toggleClass("mini-sidebar");
    if ($("#main-wrapper").hasClass("mini-sidebar")) {
      $(".sidebartoggler").prop("checked", !0);
      $("#main-wrapper").attr("data-sidebartype", "mini-sidebar");
    } else {
      $(".sidebartoggler").prop("checked", !1);
      $("#main-wrapper").attr("data-sidebartype", "full");
    }
  });
  $(".sidebartoggler").on("click", function () {
    $("#main-wrapper").toggleClass("show-sidebar");
  });
})

$(document).ready(function() {
  $('#editProductModal').on('show.bs.modal', function(event) {
    var button = $(event.relatedTarget);
    var id = button.data('id');
    var name = button.data('name');
    var description = button.data('description');
    var price = button.data('price');
    var category = button.data('category');
    var subcategory = button.data('subcategory');
    var extracategory = button.data('extracategory');

    var modal = $(this);
    modal.find('#editProName').val(name);
    modal.find('#editProDescription').val(description);
    modal.find('#editProPrice').val(price);
    modal.find('#editCategory').val(category);
    modal.find('#editSubcategory').val(subcategory);
    modal.find('#editExtracategory').val(extracategory);

    modal.find('#editProductForm').attr('action', '/product/update/' + id);
  });
});

// otp verify 

document.getElementById('forgotForm').addEventListener('submit', function (e) {
  e.preventDefault();
  const email = document.getElementById('email').value;
  if (email) {
    $.ajax({
      url: '/forgot',
      type: 'POST',
      data: { email: email },
      success: function (response) {
        alert('OTP sent successfully!');
        document.getElementById('forgotForm').style.display = 'none';
        document.getElementById('verifyForm').style.display = 'block';
      },
      error: function (error) {
        alert('Error sending OTP. Please try again.');
      }
    });
  }
});
document.getElementById('verifyForm').addEventListener('submit', function (e) {
  e.preventDefault();
  const otp = document.getElementById('otp').value;
  if (otp) {
    $.ajax({
      url: '/verify',
      type: 'POST',
      data: { otp: otp },
      success: function (response) {
        if (response === 'OTP Verified') {
          alert('OTP Verified!');
          document.getElementById('verifyForm').style.display = 'none';
          document.getElementById('resetForm').style.display = 'block';
        } else {
          alert('Invalid OTP. Please try again.');
        }
      },
      error: function (error) {
        alert('Error verifying OTP. Please try again.');
      }
    });
  }
});
document.getElementById('resetForm').addEventListener('submit', function (e) {
  e.preventDefault();
  const newPassword = document.getElementById('newPassword').value;
  const confirmPassword = document.getElementById('confirmPassword').value;
  const email = document.getElementById('email').value;
  if (newPassword && confirmPassword && newPassword === confirmPassword) {
    $.ajax({
      url: '/resetPassword',
      type: 'POST',
      data: { newPassword: newPassword, confirmPassword: confirmPassword, email: email },
      success: function (response) {
        alert('Password reset successfully!');
        window.location.href = '/login';
      },
      error: function (error) {
        alert('Error resetting password. Please try again.');
      }
    });
  } else {
    alert('Passwords do not match. Please try again.');
  }
});
